<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Учет заказов</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="app-container">
        <section id="auth" class="page active">
            <div class="header">
                <div class="logo">
                    <svg width="60" height="60" viewBox="0 0 56 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5.03906 12.2031C4.1276 12.2031 3.34375 12.0208 2.6875 11.6562C2.03646 11.2865 1.53385 10.763 1.17969 10.0859C0.825521 9.40885 0.648438 8.59896 0.648438 7.65625V7.64844C0.648438 6.71094 0.822917 5.90365 1.17188 5.22656C1.52604 4.54427 2.02344 4.02083 2.66406 3.65625C3.30469 3.28646 4.0625 3.10156 4.9375 3.10156C5.8125 3.10156 6.57031 3.28125 7.21094 3.64062C7.85156 4 8.34635 4.50781 8.69531 5.16406C9.04427 5.82031 9.21875 6.59115 9.21875 7.47656V8.27344H2.02344V6.66406H7.90625L6.625 8.20312V7.10156C6.625 6.65885 6.55729 6.28906 6.42188 5.99219C6.28646 5.6901 6.09635 5.46094 5.85156 5.30469C5.61198 5.14844 5.33073 5.07031 5.00781 5.07031C4.6849 5.07031 4.40104 5.15104 4.15625 5.3125C3.91146 5.46875 3.71875 5.69792 3.57812 6C3.44271 6.30208 3.375 6.66927 3.375 7.10156V8.21875C3.375 8.64062 3.44271 9.0026 3.57812 9.30469C3.71354 9.60677 3.90885 9.83854 4.16406 10C4.42448 10.1562 4.73438 10.2344 5.09375 10.2344C5.40104 10.2344 5.65885 10.1875 5.86719 10.0938C6.08073 9.99479 6.2474 9.88542 6.36719 9.76562C6.49219 9.64583 6.57292 9.54948 6.60938 9.47656L6.63281 9.44531L9.16406 9.4375L9.14062 9.53125C9.08333 9.78646 8.96615 10.0703 8.78906 10.3828C8.61719 10.6901 8.36979 10.9818 8.04688 11.2578C7.72917 11.5339 7.32292 11.7604 6.82812 11.9375C6.33333 12.1146 5.73698 12.2031 5.03906 12.2031ZM13.0681 12.0156C11.9275 12.0156 11.1098 11.8281 10.615 11.4531C10.1202 11.0781 9.87281 10.4661 9.87281 9.61719V5.33594H8.54469V3.30469H9.87281V1.3125H12.6541V3.30469H14.3962V5.33594H12.6541V8.99219C12.6541 9.3151 12.7374 9.55729 12.9041 9.71875C13.0759 9.88021 13.3416 9.96094 13.7009 9.96094C13.8572 9.96094 13.9874 9.95833 14.0916 9.95312C14.1957 9.94271 14.2973 9.93229 14.3962 9.92188V11.9062C14.2504 11.9375 14.0577 11.9635 13.8181 11.9844C13.5837 12.0052 13.3337 12.0156 13.0681 12.0156ZM14.5347 12V0.0390625H17.3081V4.66406H17.4566C17.6493 4.1901 17.9566 3.8125 18.3784 3.53125C18.8055 3.24479 19.3264 3.10156 19.9409 3.10156C20.5816 3.10156 21.118 3.23177 21.5503 3.49219C21.9878 3.7474 22.3185 4.11979 22.5425 4.60938C22.7665 5.09375 22.8784 5.6849 22.8784 6.38281V12H20.105V7C20.105 6.47396 19.993 6.07031 19.7691 5.78906C19.5503 5.5026 19.2066 5.35938 18.7378 5.35938C18.4409 5.35938 18.1857 5.42969 17.9722 5.57031C17.7586 5.71094 17.5946 5.90625 17.48 6.15625C17.3654 6.40625 17.3081 6.69792 17.3081 7.03125V12H14.5347ZM27.1497 12.2031C26.2382 12.2031 25.4544 12.0208 24.7981 11.6562C24.1471 11.2865 23.6445 10.763 23.2903 10.0859C22.9361 9.40885 22.7591 8.59896 22.7591 7.65625V7.64844C22.7591 6.71094 22.9335 5.90365 23.2825 5.22656C23.6367 4.54427 24.1341 4.02083 24.7747 3.65625C25.4153 3.28646 26.1731 3.10156 27.0481 3.10156C27.9231 3.10156 28.6809 3.28125 29.3216 3.64062C29.9622 4 30.457 4.50781 30.8059 5.16406C31.1549 5.82031 31.3294 6.59115 31.3294 7.47656V8.27344H24.1341V6.66406H30.0169L28.7356 8.20312V7.10156C28.7356 6.65885 28.6679 6.28906 28.5325 5.99219C28.3971 5.6901 28.207 5.46094 27.9622 5.30469C27.7226 5.14844 27.4414 5.07031 27.1184 5.07031C26.7955 5.07031 26.5117 5.15104 26.2669 5.3125C26.0221 5.46875 25.8294 5.69792 25.6887 6C25.5533 6.30208 25.4856 6.66927 25.4856 7.10156V8.21875C25.4856 8.64062 25.5533 9.0026 25.6887 9.30469C25.8242 9.60677 26.0195 9.83854 26.2747 10C26.5351 10.1562 26.845 10.2344 27.2044 10.2344C27.5117 10.2344 27.7695 10.1875 27.9778 10.0938C28.1914 9.99479 28.358 9.88542 28.4778 9.76562C28.6028 9.64583 28.6835 9.54948 28.72 9.47656L28.7434 9.44531L31.2747 9.4375L31.2512 9.53125C31.194 9.78646 31.0768 10.0703 30.8997 10.3828C30.7278 10.6901 30.4804 10.9818 30.1575 11.2578C29.8398 11.5339 29.4335 11.7604 28.9387 11.9375C28.444 12.1146 27.8476 12.2031 27.1497 12.2031ZM31.2959 12V3.30469H34.0694V4.6875H34.2178C34.348 4.20833 34.5954 3.83594 34.96 3.57031C35.3298 3.30469 35.7907 3.17188 36.3428 3.17188C36.5147 3.17188 36.6814 3.1849 36.8428 3.21094C37.0043 3.23177 37.1527 3.26562 37.2881 3.3125V5.65625C37.1058 5.60417 36.9157 5.5651 36.7178 5.53906C36.5199 5.51302 36.3246 5.5 36.1319 5.5C35.6996 5.5 35.3298 5.57552 35.0225 5.72656C34.7152 5.8724 34.4782 6.08854 34.3116 6.375C34.1501 6.65625 34.0694 7 34.0694 7.40625V12H31.2959ZM40.7547 12.2031C39.8432 12.2031 39.0594 12.0208 38.4031 11.6562C37.7521 11.2865 37.2495 10.763 36.8953 10.0859C36.5411 9.40885 36.3641 8.59896 36.3641 7.65625V7.64844C36.3641 6.71094 36.5385 5.90365 36.8875 5.22656C37.2417 4.54427 37.7391 4.02083 38.3797 3.65625C39.0203 3.28646 39.7781 3.10156 40.6531 3.10156C41.5281 3.10156 42.2859 3.28125 42.9266 3.64062C43.5672 4 44.062 4.50781 44.4109 5.16406C44.7599 5.82031 44.9344 6.59115 44.9344 7.47656V8.27344H37.7391V6.66406H43.6219L42.3406 8.20312V7.10156C42.3406 6.65885 42.2729 6.28906 42.1375 5.99219C42.0021 5.6901 41.812 5.46094 41.5672 5.30469C41.3276 5.14844 41.0464 5.07031 40.7234 5.07031C40.4005 5.07031 40.1167 5.15104 39.8719 5.3125C39.6271 5.46875 39.4344 5.69792 39.2938 6C39.1583 6.30208 39.0906 6.66927 39.0906 7.10156V8.21875C39.0906 8.64062 39.1583 9.0026 39.2938 9.30469C39.4292 9.60677 39.6245 9.83854 39.8797 10C40.1401 10.1562 40.45 10.2344 40.8094 10.2344C41.1167 10.2344 41.3745 10.1875 41.5828 10.0938C41.7964 9.99479 41.963 9.88542 42.0828 9.76562C42.2078 9.64583 42.2885 9.54948 42.325 9.47656L42.3484 9.44531L44.8797 9.4375L44.8563 9.53125C44.799 9.78646 44.6818 10.0703 44.5047 10.3828C44.3328 10.6901 44.0854 10.9818 43.7625 11.2578C43.4448 11.5339 43.0385 11.7604 42.5438 11.9375C42.049 12.1146 41.4526 12.2031 40.7547 12.2031ZM47.2681 12.1328C46.716 12.1328 46.2291 12.0234 45.8072 11.8047C45.3853 11.5859 45.0546 11.2812 44.815 10.8906C44.5806 10.4948 44.4634 10.0339 44.4634 9.50781V9.49219C44.4634 8.96615 44.5962 8.51562 44.8619 8.14062C45.1327 7.76042 45.5259 7.46354 46.0416 7.25C46.5624 7.03646 47.1952 6.90625 47.94 6.85938L51.1978 6.66406V8.21875L48.3775 8.39844C47.9712 8.42448 47.6614 8.51562 47.4478 8.67188C47.2343 8.82812 47.1275 9.03646 47.1275 9.29688V9.3125C47.1275 9.58333 47.2343 9.79948 47.4478 9.96094C47.6614 10.1224 47.9426 10.2031 48.2916 10.2031C48.5832 10.2031 48.8436 10.1458 49.0728 10.0312C49.3072 9.91146 49.4921 9.7526 49.6275 9.55469C49.7681 9.35156 49.8384 9.125 49.8384 8.875V6.07031C49.8384 5.77344 49.7317 5.54427 49.5181 5.38281C49.3098 5.21615 49.0155 5.13281 48.6353 5.13281C48.2707 5.13281 47.9765 5.19271 47.7525 5.3125C47.5337 5.43229 47.3827 5.59896 47.2994 5.8125L47.2837 5.85156H44.7759L44.7837 5.75781C44.8358 5.22135 45.0285 4.75521 45.3619 4.35938C45.7004 3.96354 46.1614 3.65625 46.7447 3.4375C47.328 3.21354 48.0103 3.10156 48.7916 3.10156C49.5989 3.10156 50.2811 3.21875 50.8384 3.45312C51.4009 3.6875 51.828 4.02604 52.1197 4.46875C52.4114 4.91146 52.5572 5.44531 52.5572 6.07031V12H49.8384V10.9219H49.69C49.5598 11.1667 49.3749 11.3802 49.1353 11.5625C48.9009 11.7448 48.6223 11.8854 48.2994 11.9844C47.9817 12.0833 47.6379 12.1328 47.2681 12.1328ZM52.9847 12V0.0390625H55.7581V12H52.9847Z" fill="var(--text-color)"/>
                    </svg>
                </div>
                <div class="theme-switcher">
                    <label class="switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
            <div class="auth-forms">
                <div class="auth-form-container" id="login-form-container">
                    <h2 class="title">Вход</h2>
                    <form id="loginForm">
                        <input type="text" name="username" placeholder="Имя пользователя" required>
                        <input type="password" name="password" placeholder="Пароль" required>
                        <button type="submit">Войти</button>
                    </form>
                    <p class="toggle-auth">Нет аккаунта? <a href="#" onclick="showRegister()">Зарегистрироваться</a></p>
                </div>
                <div class="auth-form-container" id="register-form-container" style="display: none;">
                    <h2 class="title">Регистрация</h2>
                    <form id="registerForm">
                        <input type="text" name="username" placeholder="Имя пользователя" required>
                        <input type="password" name="password" placeholder="Пароль" required>
                        <button type="submit">Зарегистрироваться</button>
                    </form>
                    <p class="toggle-auth">Уже есть аккаунт? <a href="#" onclick="showLogin()">Войти</a></p>
                </div>
                <p id="status"></p>
            </div>
        </section>

        <div id="main-app" class="page" style="display: none;">
            <div class="tab-bar">
                <button onclick="showPage('order')" class="tab-item active" data-page-id="order">
                    <svg class="icon-outline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="var(--text-color)" stroke-width="1.5"/><path d="M15 12H12M12 12H9M12 12V9M12 12V15" stroke="var(--text-color)" stroke-width="1.5" stroke-linecap="round"/></svg>
                    <svg class="icon-bold" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity="0.5"/><path  d="M12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25z"/></svg>
                </button>
                <button onclick="showPage('orders-list')" class="tab-item" data-page-id="orders-list">
                    <svg class="icon-outline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.287 3.15196L14.36 4.07896L5.83902 12.599C5.26202 13.177 4.97302 13.466 4.72502 13.784C4.43241 14.1594 4.18128 14.5655 3.97602 14.995C3.80302 15.359 3.67402 15.747 3.41602 16.521L2.32202 19.802L2.05402 20.604C1.99133 20.7909 1.98203 20.9916 2.02716 21.1836C2.07229 21.3755 2.17007 21.5511 2.30949 21.6905C2.44891 21.8299 2.62446 21.9277 2.81641 21.9728C3.00835 22.018 3.20907 22.0087 3.39602 21.946L4.19802 21.678L7.47902 20.584C8.25402 20.326 8.64102 20.197 9.00502 20.024C9.43635 19.8186 9.84002 19.569 10.216 19.275C10.534 19.027 10.823 18.738 11.4 18.161L19.921 9.63997L20.848 8.71297C21.5855 7.97553 21.9997 6.97535 21.9997 5.93246C21.9997 4.88958 21.5855 3.8894 20.848 3.15196C20.1106 2.41453 19.1104 2.00024 18.0675 2.00024C17.0246 2.00024 16.0245 2.41453 15.287 3.15196Z" stroke="var(--text-color)" stroke-width="1.5"/><path opacity="0.5" d="M14.36 4.07788C14.36 4.07788 14.476 6.04788 16.214 7.78588C17.952 9.52388 19.921 9.63888 19.921 9.63888M4.19802 21.6779L2.32202 19.8019" stroke="var(--text-color)" stroke-width="1.5"/></svg>
                    <svg class="icon-bold" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M20.849 8.713a3.932 3.932 0 0 0-5.562-5.561l-.887.887l.038.111a8.75 8.75 0 0 0 2.093 3.32a8.75 8.75 0 0 0 3.43 2.13z" opacity="0.5"/><path  d="m14.439 4l-.039.038l.038.112a8.75 8.75 0 0 0 2.093 3.32a8.75 8.75 0 0 0 3.43 2.13l-8.56 8.56c-.578.577-.867.866-1.185 1.114a6.6 6.6 0 0 1-1.211.748c-.364.174-.751.303-1.526.561l-4.083 1.361a1.06 1.06 0 0 1-1.342-1.341l1.362-4.084c.258-.774.387-1.161.56-1.525q.309-.646.749-1.212c.248-.318.537-.606 1.114-1.183z"/></svg>
                </button>
                <button onclick="showPage('report')" class="tab-item" data-page-id="report">
                    <svg class="icon-outline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" d="M16 4.00195C18.175 4.01395 19.353 4.11095 20.121 4.87895C21 5.75795 21 7.17195 21 9.99995V16C21 18.829 21 20.243 20.121 21.122C19.243 22 17.828 22 15 22H9C6.172 22 4.757 22 3.879 21.122C3 20.242 3 18.829 3 16V9.99995C3 7.17195 3 5.75795 3.879 4.87895C4.647 4.11095 5.825 4.01395 8 4.00195" stroke="var(--text-color)" stroke-width="1.5"/><path d="M10.5 14H17M7 14H7.5M7 10.5H7.5M7 17.5H7.5M10.5 10.5H17M10.5 17.5H17" stroke="var(--text-color)" stroke-width="1.5" stroke-linecap="round"/><path d="M8 3.5C8 3.10218 8.15804 2.72064 8.43934 2.43934C8.72064 2.15804 9.10218 2 9.5 2H14.5C14.8978 2 15.2794 2.15804 15.5607 2.43934C15.842 2.72064 16 3.10218 16 3.5V4.5C16 4.89782 15.842 5.27936 15.5607 5.56066C15.2794 5.84196 14.8978 6 14.5 6H9.5C9.10218 6 8.72064 5.84196 8.43934 5.56066C8.15804 5.27936 8 4.89782 8 4.5V3.5Z" stroke="var(--text-color)" stroke-width="1.5"/></svg>
                    <svg class="icon-bold" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path  d="M21 15.998v-6c0-2.828 0-4.242-.879-5.121C19.353 4.109 18.175 4.012 16 4H8c-2.175.012-3.353.109-4.121.877C3 5.756 3 7.17 3 9.998v6c0 2.829 0 4.243.879 5.122c.878.878 2.293.878 5.121.878h6c2.828 0 4.243 0 5.121-.878c.879-.88.879-2.293.879-5.122" opacity="0.5"/><path d="M8 3.5A1.5 1.5 0 0 1 9.5 2h5A1.5 1.5 0 0 1 16 3.5v1A1.5 1.5 0 0 1 14.5 6h-5A1.5 1.5 0 0 1 8 4.5z"/><path fill-rule="evenodd" d="M6.25 10.5A.75.75 0 0 1 7 9.75h.5a.75.75 0 0 1 0 1.5H7a.75.75 0 0 1-.75-.75m3.5 0a.75.75 0 0 1 .75-.75H17a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1-.75-.75M6.25 14a.75.75 0 0 1 .75-.75h.5a.75.75 0 0 1 0 1.5H7a.75.75 0 0 1-.75-.75m3.5 0a.75.75 0 0 1 .75-.75H17a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1-.75-.75m-3.5 3.5a.75.75 0 0 1 .75-.75h.5a.75.75 0 0 1 0 1.5H7a.75.75 0 0 1-.75-.75m3.5 0a.75.75 0 0 1 .75-.75H17a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1-.75-.75" clip-rule="evenodd"/></svg>
                </button>
                <button onclick="showPage('profile')" class="tab-item" data-page-id="profile">
                    <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M13.765 2.152C13.398 2 12.932 2 12 2s-1.398 0-1.765.152a2 2 0 0 0-1.083 1.083c-.092.223-.129.484-.143.863a1.62 1.62 0 0 1-.79 1.353a1.62 1.62 0 0 1-1.567.008c-.336-.178-.579-.276-.82-.308a2 2 0 0 0-1.478.396C4.04 5.79 3.806 6.193 3.34 7s-.7 1.21-.751 1.605a2 2 0 0 0 .396 1.479c.148.192.355.353.676.555c.473.297.777.803.777 1.361s-.304 1.064-.777 1.36c-.321.203-.529.364-.676.556a2 2 0 0 0-.396 1.479c.052.394.285.798.75 1.605c.467.807.7 1.21 1.015 1.453a2 2 0 0 0 1.479.396c.24-.032.483-.13.819-.308a1.62 1.62 0 0 1 1.567.008c.483.28.77.795.79 1.353c.014.38.05.64.143.863a2 2 0 0 0 1.083 1.083C10.602 22 11.068 22 12 22s1.398 0 1.765-.152a2 2 0 0 0 1.083-1.083c.092-.223.129-.483.143-.863c.02-.558.307-1.074.79-1.353a1.62 1.62 0 0 1 1.567-.008c.336.178.579.276.819.308a2 2 0 0 0 1.479-.396c.315-.242.548-.646 1.014-1.453s.7-1.21.751-1.605a2 2 0 0 0-.396-1.479c-.148-.192-.355-.353-.676-.555A1.62 1.62 0 0 1 19.562 12c0-.558.304-1.064.777-1.36c.321-.203.529-.364.676-.556a2 2 0 0 0 .396-1.479c-.052-.394-.285-.798-.75-1.605c-.467-.807-.7-1.21-1.015-1.453a2 2 0 0 0-1.479-.396c-.24.032-.483.13-.82.308a1.62 1.62 0 0 1-1.566-.008a1.62 1.62 0 0 1-.79-1.353c-.014-.38-.05-.64-.143-.863a2 2 0 0 0-1.083-1.083Z" opacity="0.5"/></g></svg>
                    <svg class="icon-bold" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path  fill-rule="evenodd" d="M14.279 2.152C13.909 2 13.439 2 12.5 2s-1.408 0-1.779.152a2 2 0 0 0-1.09 1.083c-.094.223-.13.484-.145.863a1.62 1.62 0 0 1-.796 1.353a1.64 1.64 0 0 1-1.579.008c-.338-.178-.583-.276-.825-.308a2.03 2.03 0 0 0-1.49.396c-.318.242-.553.646-1.022 1.453c-.47.807-.704 1.21-.757 1.605c-.07.526.074 1.058.4 1.479c.148.192.357.353.68.555c.477.297.783.803.783 1.361s-.306 1.064-.782 1.36c-.324.203-.533.364-.682.556a2 2 0 0 0-.399 1.479c.053.394.287.798.757 1.605s.704 1.21 1.022 1.453c.424.323.96.465 1.49.396c.242-.032.487-.13.825-.308a1.64 1.64 0 0 1 1.58.008c.486.28.774.795.795 1.353c.015.38.051.64.145.863c.204.49.596.88 1.09 1.083c.37.152.84.152 1.779.152s1.409 0 1.779-.152a2 2 0 0 0 1.09-1.083c.094-.223.13-.483.145-.863c.02-.558.309-1.074.796-1.353a1.64 1.64 0 0 1 1.579-.008c.338.178.583.276.825.308c.53.07 1.066-.073 1.49-.396c.318-.242.553-.646 1.022-1.453c.47-.807.704-1.21.757-1.605a2 2 0 0 0-.4-1.479c-.148-.192-.357-.353-.68-.555c-.477-.297-.783-.803-.783-1.361s.306-1.064.782-1.36c.324-.203.533-.364.682-.556a2 2 0 0 0 .399-1.479c-.053-.394-.287-.798-.757-1.605s-.704-1.21-1.022-1.453a2.03 2.03 0 0 0-1.49-.396c-.242.032-.487.13-.825.308a1.64 1.64 0 0 1-1.58-.008a1.62 1.62 0 0 1-.795-1.353c-.015-.38-.051-.64-.145-.863a2 2 0 0 0-1.09-1.083" clip-rule="evenodd" opacity="0.5"/><path  d="M15.523 12c0 1.657-1.354 3-3.023 3s-3.023-1.343-3.023-3S10.83 9 12.5 9s3.023 1.343 3.023 3"/></svg>
                </button>
            </div>
            <main class="content">
<section id="order" class="page active">
    <h2 class="title">Новый заказ</h2>
    <form id="orderForm">
        <div class="input-container">
            <input type="date" name="date" class="has-placeholder" data-placeholder="Дата заказа" required>
        </div>
        <input type="text" name="title" placeholder="Название заказа" required>
        <input type="number" name="packages" placeholder="Количество пакетов" required>
        <input type="number" name="price" value="1" step="0.01" placeholder="Цена за пакет">
        <button type="submit">Сохранить</button>
    </form>
            </section>
            <section id="order" class="page active">
                    <h2 class="title">Новый заказ</h2>
                    <form id="orderForm">
                        <input type="date" name="date" class="has-placeholder" data-placeholder="Дата заказа" required>
                        <input type="text" name="title" placeholder="Название заказа" required>
                        <input type="number" name="packages" placeholder="Количество пакетов" required>
                        <input type="number" name="price" value="1" step="0.01" placeholder="Цена за пакет">
                        <button type="submit">Сохранить</button>
                    </form>
                </section>
                <section id="orders-list" class="page">
                    <h2 class="title">Список заказов</h2>
                    <input type="date" id="filterDate" class="has-placeholder" data-placeholder="Дата заказа">
                    <button onclick="loadOrders()">Показать</button>
                    <div id="ordersContent"></div>
                </section>
                <section id="report" class="page">
                    <h2 class="title">Отчёт</h2>
                    <input type="date" id="startDate" class="has-placeholder" data-placeholder="Начало периода">
                    <input type="date" id="endDate" class="has-placeholder" data-placeholder="Конец периода">
                    <div class="button-container">
                        <button onclick="getReport()">Сформировать отчёт</button>
                    </div>
                    <div id="reportResult"></div>
            </section>
                <section id="profile" class="page">
                    <h2 class="title">Профиль пользователя</h2>
                    <div class="profile-info">
                        <p><strong>Логин:</strong> <div  class="report-item"><span id="profile-username"></span></div></p>
                        <p>
                            <strong>Пароль:</strong>
                            <div  class="report-item">
                            <span id="profile-password-display" style="display: none;"></span>
                            <span id="profile-password-dots">••••••••</span>
                            </div>
                            <button id="toggle-password-btn">Показать</button>
                            <hr class="separator">
                        </p>
                        <p><strong>Всего заработано:</strong> <span id="total-earned">0</span> сом</p>
                    </div>
                    <hr class="separator">
                    <div class="settings-block">
                        <h3>Настройки</h3>
                        <div class="theme-switch-container">
                            <span>Темная тема:</span>
                            <label class="switch">
                                <input type="checkbox" id="profile-theme-toggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <button class="logout-btn">Выйти</button>
                </section>
            </main>
        </div>
    </div>
<script>
    const { createClient } = window.supabase;
    const supabaseUrl = 'https://wagljnxlaehfjliwidqw.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhZ2xqbnhsYWVoZmpsaXdpZHF3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczMzk2NzksImV4cCI6MjA3MjkxNTY3OX0.4Ys9NduopSkGEspG9L3pyOegdDTWqlb0SRfk8wCoJYQ';
    const supabase = createClient(supabaseUrl, supabaseKey);

    // --- 1. Page and Theme Management ---
    const themeToggle = document.getElementById('theme-toggle');
    const profileThemeToggle = document.getElementById('profile-theme-toggle');

    // **Новая функция для инициализации инпутов даты**
      function initializeDateInputs() {
        document.querySelectorAll('input[type="date"].has-placeholder').forEach(input => {
            const checkValue = () => {
                if (input.value) {
                    input.classList.remove('has-placeholder');
                } else {
                    input.classList.add('has-placeholder');
                }
            };

            // Проверяем при загрузке или смене страницы
            checkValue();

            // Проверяем при изменении значения
            input.addEventListener('change', checkValue);
        });
    }

    function applyTheme(isDark) {
        document.body.classList.toggle('dark-theme', isDark);
    }

    async function saveThemePreference(isDark) {
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
            await supabase.from('users').update({ theme: isDark ? 'dark' : 'light' }).eq('id', user.id);
        }
    }

    async function loadThemePreference() {
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
            const { data, error } = await supabase.from('users').select('theme').eq('id', user.id).single();
            const isDark = (data && data.theme === 'dark');
            applyTheme(isDark);
            themeToggle.checked = isDark;
            profileThemeToggle.checked = isDark;
        }
    }

    themeToggle.addEventListener('change', (e) => {
        const isDark = e.target.checked;
        applyTheme(isDark);
        saveThemePreference(isDark);
        profileThemeToggle.checked = isDark;
    });

    profileThemeToggle.addEventListener('change', (e) => {
        const isDark = e.target.checked;
        applyTheme(isDark);
        saveThemePreference(isDark);
        themeToggle.checked = isDark;
    });

    function showPage(pageId) {
        document.querySelectorAll('#main-app .page').forEach(page => {
            page.style.display = 'none';
        });

        document.getElementById(pageId).style.display = 'block';

        document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
        const activeTab = document.querySelector(`.tab-item[data-page-id="${pageId}"]`);
        if (activeTab) activeTab.classList.add('active');

        if (pageId === 'profile') {
            loadProfileData();
        }

        // Вызываем функцию инициализации полей после показа страницы
        initializeDateInputs();
    }

    function showAuth() {
        document.getElementById('auth').style.display = 'block';
        document.getElementById('main-app').style.display = 'none';
        showLogin();
    }

    async function checkSession() {
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
            showApp();
        } else {
            showAuth();
        }
    }

    function showApp() {
        document.getElementById('auth').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        showPage('order');
        loadThemePreference();
    }

    function showLogin() {
        document.getElementById('login-form-container').style.display = 'block';
        document.getElementById('register-form-container').style.display = 'none';
    }

    function showRegister() {
        document.getElementById('login-form-container').style.display = 'none';
        document.getElementById('register-form-container').style.display = 'block';
    }

    // --- 2. Authentication Logic ---
    async function registerUser(username, password) {
        document.getElementById('status').textContent = 'Регистрация...';
        const email = username + '@localapp.com';
        const { data, error } = await supabase.auth.signUp({ email, password });

        if (error) {
            document.getElementById('status').textContent = 'Ошибка: ' + error.message;
            console.error('Registration error:', error);
        } else {
            const { error: profileError } = await supabase.from('users').insert({ id: data.user.id, username: username, theme: 'light' });
            if (profileError) {
                console.error('Profile creation error:', profileError);
                document.getElementById('status').textContent = 'Ошибка создания профиля: ' + profileError.message;
            } else {
                document.getElementById('status').textContent = 'Регистрация успешна. Теперь вы можете войти.';
                setTimeout(() => { showLogin(); document.getElementById('status').textContent = ''; }, 3000);
            }
        }
    }

    async function loginUser(username, password) {
        document.getElementById('status').textContent = 'Вход...';
        const email = username + '@localapp.com';
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });

        if (error) {
            document.getElementById('status').textContent = 'Ошибка: ' + error.message;
            console.error('Login error:', error);
        } else {
            document.getElementById('status').textContent = 'Вход успешен!';
            showApp();
        }
    }

    // --- 3. Data Handling Functions ---
    async function loadOrders() {
        const date = document.getElementById("filterDate").value;
        if (!date) {
            alert("Выбери дату!");
            return;
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            alert('Вы не авторизованы!');
            return;
        }

        const { data, error } = await supabase.from("orders").select("*").eq("date", date).eq('user_id', user.id);
        const ordersList = document.getElementById("ordersContent");
        if (error) {
            console.error("Ошибка при загрузке заказов:", error);
            ordersList.innerHTML = "<p>Ошибка при загрузке данных.</p>";
            return;
        }
        if (!data || data.length === 0) {
            ordersList.innerHTML = "<p>Нет заказов за выбранную дату.</p>";
            return;
        }

        ordersList.innerHTML = data.map(order => `
            <div class="order-item" data-id="${order.id}" data-title="${order.title}" data-packages="${order.packages}" data-price="${order.price}">
                <div><strong>Название:</strong> ${order.title}</div>
                <div><strong>Пакетов:</strong> ${order.packages}</div>
                <div><strong>Цена:</strong> ${parseFloat(order.price)}</div>
                <div class="actions">
                    <button class="edit-btn">Редактировать</button>
                    <button class="delete-btn">Удалить</button>
                </div>
            </div>
        `).join('');
    }

    document.getElementById('orderForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const date = form.date.value;
        const title = form.title.value;
        const packages = parseInt(form.packages.value, 10);
        const price = parseFloat(form.price.value);

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            alert('Вы не авторизованы!');
            return;
        }

        const { error } = await supabase.from('orders').insert([
            { date, title, packages, price, user_id: user.id }
        ]);

        if (error) {
            alert('Ошибка сохранения!');
            console.error(error);
        } else {
            alert('Заказ сохранен!');
            form.reset();
        }
    });

    async function deleteOrder(id) {
        if (!confirm("Вы уверены, что хотите удалить этот заказ?")) return;
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            alert('Вы не авторизованы!');
            return;
        }
        const { error } = await supabase.from("orders").delete().eq("id", id).eq('user_id', user.id);
        if (error) {
            console.error("Ошибка при удалении заказа:", error);
            alert("Не удалось удалить заказ.");
            return;
        }
        alert("Заказ успешно удален!");
        loadOrders();
    }

    async function editOrder(id, title, packages, price) {
        const newTitle = prompt("Название заказа:", title);
        if (newTitle === null) return;
        const newPackages = prompt("Количество пакетов:", packages);
        if (newPackages === null) return;
        const newPrice = prompt("Цена за пакет:", price);
        if (newPrice === null) return;

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            alert('Вы не авторизованы!');
            return;
        }

        const { error } = await supabase.from("orders").update({
            title: newTitle,
            packages: parseInt(newPackages, 10),
            price: parseFloat(newPrice)
        }).eq("id", id).eq('user_id', user.id);

        if (error) {
            console.error("Ошибка при обновлении заказа:", error);
            alert("Не удалось обновить заказ.");
            return;
        }
        alert("Заказ успешно обновлен!");
        loadOrders();
    }

    async function getReport() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            alert('Вы не авторизованы!');
            return;
        }

        let query = supabase.from('orders').select('*').eq('user_id', user.id);
        if (startDate && endDate) {
            query = query.gte('date', startDate).lte('date', endDate);
        }
        const { data, error } = await query;
        const reportResult = document.getElementById('reportResult');
        if (error) {
            reportResult.innerHTML = '<p>Ошибка при получении отчета.</p>';
            console.error("Ошибка при получении отчёта:", error);
            return;
        }
        if (!data || data.length === 0) {
            reportResult.innerHTML = '<p>Нет данных за выбранный период.</p>';
            return;
        }

        let total = 0;
        let html = '<h3>Суммы по заказам:</h3>';
        data.forEach(order => {
            const sum = order.packages * order.price;
            total += sum;
            const dateParts = order.date.split('-');
            const formattedDate = `${dateParts[2]}.${dateParts[1]}`;
            html += `<div class="report-item"><span style="color: #999;">${formattedDate} </span>${order.title}<span style="color: #999;"> — </span>${order.packages}<span style="color: #999;"> × </span>${parseFloat(order.price)}<span style="color: #999;"> = </span>${parseFloat(sum)}</div><hr class="separator">`;
        });
        html += `<p style="font-size: 20px"><b>Итого: ${parseFloat(total).toFixed(2)} <span style="color: #999;"> сом </span> </b></p>`;
        reportResult.innerHTML = html;
    }

    async function loadProfileData() {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            alert('Вы не авторизованы!');
            return;
        }

        const username = user.email.replace('@localapp.com', '');
        const password = localStorage.getItem(`password-${username}`);

        document.getElementById('profile-username').textContent = username;
        document.getElementById('profile-password-display').textContent = password;

        const { data: orders, error } = await supabase.from('orders').select('packages, price').eq('user_id', user.id);
        if (error) {
            console.error('Ошибка при расчете заработка:', error);
            document.getElementById('total-earned').textContent = 'Ошибка';
            return;
        }

        const totalEarned = orders.reduce((sum, order) => sum + (order.packages * order.price), 0);
        document.getElementById('total-earned').textContent = parseFloat(totalEarned).toFixed(2);
    }

    async function logout() {
        const { error } = await supabase.auth.signOut();
        if (error) {
            console.error('Ошибка выхода:', error);
        } else {
            showAuth();
        }
    }

    // --- 4. Event Listeners ---
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = e.target.username.value;
        const password = e.target.password.value;
        registerUser(username, password);
    });

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const username = e.target.username.value;
        const password = e.target.password.value;
        localStorage.setItem(`password-${username}`, password);
        loginUser(username, password);
    });

    document.getElementById('ordersContent').addEventListener('click', (event) => {
        const target = event.target;
        const orderItem = target.closest('.order-item');
        if (!orderItem) return;
        const id = orderItem.dataset.id;
        if (target.classList.contains('edit-btn')) {
            const { title, packages, price } = orderItem.dataset;
            editOrder(id, title, packages, price);
        } else if (target.classList.contains('delete-btn')) {
            deleteOrder(id);
        }
    });

    document.getElementById('toggle-password-btn').addEventListener('click', () => {
        const passwordDisplay = document.getElementById('profile-password-display');
        const passwordDots = document.getElementById('profile-password-dots');
        const button = document.getElementById('toggle-password-btn');
        if (passwordDisplay.style.display === 'none') {
            passwordDisplay.style.display = 'inline';
            passwordDots.style.display = 'none';
            button.textContent = 'Скрыть';
        } else {
            passwordDisplay.style.display = 'none';
            passwordDots.style.display = 'inline';
            button.textContent = 'Показать';
        }
    });

    document.querySelector('.logout-btn').addEventListener('click', () => {
        logout();
    });

    // **Запускаем проверку сессии и инициализацию полей ввода при загрузке страницы**
    document.addEventListener('DOMContentLoaded', () => {
        checkSession();
        initializeDateInputs();
    });
</script>
</body>
</html>